image:
- Visual Studio 2019
environment:
  HOPSAN_BUILD_SCRIPT_NOPAUSE: 1
  HOPSAN_BUILD_QT_HOME: C:\Qt\5.15.2\mingw81_64
  HOPSAN_BUILD_MINGW_HOME: C:\mingw-w64\x86_64-8.1.0-posix-seh-rt_v6-rev0\mingw64
platform: x64
configuration: Release
install:
  - git submodule update --init
  - cd dependencies
  - download-dependencies.py discount fmilibrary qwt zeromq cppzmq msgpack-c katex tclap fmi4c xerces asio zlib libzip dcplib
  - cd ..
build_script:
# Remove sh.exe from PATH so that CMake works
  - set PATH=%PATH:C:\Program Files\Git\usr\bin;=%
  - PATH
  - cd dependencies
  - setupDiscount.bat
  - setupFMILibrary.bat
  - setupFmi4c.bat
  - setupXerces.bat
  - setupZlib.bat
  - setupLibzip.bat
  - setupDCPLib.bat
#  - setupHDF5.bat (takes to long to build)
  - setupKatex.bat
  - setupTclap.bat
  - setupQwt.bat
  - setupZeroMQ.bat
  - setupMsgpack.bat
  - call setHopsanBuildPaths.bat
  - cd ..
  - cmake -G"MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=install_dir -Bbuild_dir -S.
  - cmake --build build_dir --config Release --parallel 6
  - cmake --build build_dir --config Release --parallel 6 --target install
  - cd install_dir
  - dir bin
  - cd ..
test_script:
  - cd build_dir
  - ctest -C Release --output-on-failure --parallel 4
  - cd ..
#  - set PATH=%CD%\install\bin;%PATH%
#  - runValidationTests.bat TODO Fix this
